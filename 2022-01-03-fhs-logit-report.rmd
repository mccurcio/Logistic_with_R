---
title: "Seven Top Risk Factors For Cardiovascular Disease"
subtitle: "An investigation of the Framingham Heart Study"
author: "By Matthew Curcio"
output: html_document
---


<br>

## I. Executive Summary

<br>

1. This report investigates the risk factors that lead to cardiovascular disease (CVD) using data from the Framingham Heart Study.[^1]

1. This R markdown document will demonstrate my understanding of logistic regression and R. This report is part one of two articles describing Logit.

1. Using this Heart Study data we find the five most important factors and the odds related to them.

    * By being a men vs women, the odds of acquiring CVD is an increase x.   

[^1]:The Framingham Heart Study: https://framinghamheartstudy.org/fhs-about/


<br>

## II. Disscussion

<br>

#### A. Logistic regression is an excellent choice for this investigation:

1. The outcome, the absence(0) or presence(1) of cardiovascular disease, is a binary response.

1. When using logistic regression, we are not simply predicting whether a person does or does not have a disease. **We are interested in the variables most highly associated with that disease and the probability of being in one case or another**. Based on our regression model, we hope to better understand the "predicted probability of being a case."

1. Using the probabilities of being in one case (P) versus (1-P), **we can further generalize to find the odds**, $\small P/(1-P)$ for each variable.

<br>

#### B. Independent and Dependent Variables

This longitudinal study includes thirteen independent variables including 4,133 participants over a ten year period. Patients were evaluated for the **presence or absence of cardio-vascular disease** between 1948-1960.[^2] The model is fit with 13 independent variables. Where the outcome is the **absence or presence of Cardiac Heart Disease After Ten Years**, abbreviated `TenYearCHD`.

[^2]:The Framingham Heart Study can be found at: https://www.kaggle.com/captainozlem/framingham-chd-preprocessed-data

<br>

**One dependent variable**: `TenYearCHD`

* 0 = Absence of cardio-vascular disease  
* 1 = Presence of cardio-vascular disease  

**13 independent variables**:

| No. | Independent Factors (Yes = 1, No = 0) | No. | Independent Continuous Variables |
| :-- | :---------------------------- | :-- | :------------------------------- |
| 1   | Male                          | 1   | Age                              |
| 2   | Education                     | 2   | Cigarettes Per Day               |
| 3   | Diabetic                      | 3   | Total Cholesterol                |
| 4   | Prevalence of Stroke          | 4   | Systolic Blood Pressure          |
| 5   | Prevalence of Hypertension    | 5   | Diastolic Blood Pressure         |
|     |                               | 6   | Body Mass Index                  |
|     |                               | 7   | Heart Rate                       |
|     |                               | 8   | Glucose                          |

<br>

## III. Experimental Results

```{r DONOTSHOW, message=FALSE, warning=FALSE, include=FALSE}
# DO NOT SHOW
options(tinytex.verbose = FALSE)
options(digits = 5) 

#Load Libraries
Libraries <- c("knitr", "readr", "aod", "ggplot2")
for (p in Libraries) { 
    library(p, character.only = TRUE)
}
opts_chunk$set(cache=TRUE, warning=FALSE, message=FALSE)

#Load Data
df <- read_csv("CHD_preprocessed.csv", 
     col_types = cols(male = col_factor(levels = c("0", "1")), 
                      education = col_factor(levels = c("0", "1")),
                      currentSmoker = col_skip(), 
                      BPMeds = col_skip(), 
                      prevalentStroke = col_factor(levels = c("0", "1")), 
                      prevalentHyp = col_factor(levels = c("0", "1")), 
                      diabetes = col_factor(levels = c("0", "1")), 
                      TenYearCHD = col_factor(levels = c("0", "1"))))
#view(df)
```


<br>
<br>

#### A. Logistic Regression Model


```{r cache=TRUE}
mylogit <- glm(TenYearCHD ~ male + age + education + 
                            cigsPerDay + prevalentStroke + prevalentHyp + 
                            diabetes + totChol + sysBP + diaBP + BMI +
                            heartRate + glucose,
               data = df, 
               family = "binomial")

summary(mylogit)
```


##### The 7 most significant variables

The seven predictors have $\small \alpha < 0.05$ and are associated with acquiring cardiovascular disease.

Therefore, seven of the independent variables are statistically significant. 

The log odds estimates represent the change per one unit of change for each factor.

These log odds will become more important later on when they are converted to odds.

| Rank | Risk Factor                 | Log Odds Estimate |
| :--- | :-------------------------- | :---------------- |
| 1    | Prevalence of Stroke1       | 1.00721           |
| 2    | Male1                       | 0.48093           |
| 3    | Prevalence of Hypertension1 | 0.25864           |
| 4    | Age                         | 0.06263           |
| 5    | Cigarettes Per Day          | 0.02087           |
| 6    | Systolic Blood Pressure     | 0.01498           |
| 7    | Glucose                     | 0.00619           |


<br>
<br>

#### B. Wald Test  

```{r eval=FALSE, include=FALSE}
# https://www.mbaskool.com/business-concepts/statistics/6916-wald-test.html
# https://www.statology.org/wald-test-in-r/
# https://stats.oarc.ucla.edu/other/mult-pkg/faq/general/faqhow-are-the-likelihood-ratio-wald-and-lagrange-multiplier-score-tests-different-andor-similar/
# https://handwiki.org/wiki/Wald_test
# 
# * https://questionerlab.com/what-is-the-use-of-wald-test-in-logistic-regression
# https://stats.oarc.ucla.edu/r/dae/logit-regression/
# 
# * https://bookdown.org/mike/data_analysis/wald-test.html
# 
# * https://bookdown.org/mike/data_analysis/hypothesis-testing.html#wald-test
```

```{r}
wald.test(b=coef(mylogit), Sigma=vcov(mylogit), Terms=c(2,3,5,6,7,10,14))
```



```{r}
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), Terms = c(2:14))

```



```{r}
l <- cbind(0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1)
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), L = l)

```



- Do The Predictor Variables Describe Our Model


The Wald test is a test of significance for individual regression coefficients in a logistic regression. 

Considering the 13 predictors, neglecting the intercept, we see $\chi^2$ = 333.7 with 13 degrees of freedom. This gives *P << 0.001*.

From this we can conclude that the parameters are significant and do represent useful in describing CVD.


<br>
<br>



#### C thru I:   Determination of Odds 

| 1    | Prevalence of Stroke1       | 1.00721           |
| 2    | Male1                       | 0.48093           |
| 3    | Prevalence of Hypertension1 | 0.25864           |
| 4    | Age                         | 0.06263           |
| 5    | Cigarettes Per Day          | 0.02087           |
| 6    | Systolic Blood Pressure     | 0.01498           |
| 7    | Glucose                     | 0.00619           |

We will start by calculating the predicted probability of CHCD at with respect to the five most important variables.  

## NEEDS MORE EXPLANATION
holding each one constant at their means. First we create and view the data frame.
    - Given All Other Values Held Constant
    
#### Example calculations shown for Prevalence of Stroke Factor

```{r STROKE}
strok_test <- with(df, data.frame(male = "0",
                                age = mean(age),
                                education = "0",
                                cigsPerDay = 0,
                                prevalentHyp = "0",
                                diabetes = "0",
                                totChol = mean(totChol),
                                sysBP = mean(sysBP),
                                diaBP = mean(diaBP),
                                BMI = mean(BMI),
                                heartRate = mean(heartRate),
                                glucose = mean(glucose),
                                prevalentStroke = c("0","1"))) # Factor of Interest

# REMEMBER convert prevalentStroke from numeric to FACTOR
strok_test$prevalentStroke <- as.factor(strok_test$prevalentStroke) 
# str(strok_test)

strok_test$prevalentStroke <- predict(mylogit, newdata = strok_test, type = "response")
#strok_test$prevalentStroke
```


<br>
<br>

#### D. Prevalence of Stroke Predicted Probability


#####  Probabilities Of Acquiring CVD Given Prevalence of Stroke

1. NO Prevalence of Stroke: `r strok_test$prevalentStroke[[1]]` 
2. WITH Prevalence of Stroke: `r strok_test$prevalentStroke[[2]]`

Odds = `r strok_test$prevalentStroke[[2]]/strok_test$prevalentStroke[[1]]`



----

<br>
<br>

#### F. Odds of CVD Given Male Vs Female

```{r include=FALSE}
male_test <- with(df, data.frame(male = c("0","1"), # Factor of Interest
                                  age = mean(age),
                                  education = "0",
                                  cigsPerDay = 0,
                                  prevalentHyp = "0",
                                  diabetes = "0",
                                  totChol = mean(totChol),
                                  sysBP = mean(sysBP),
                                  diaBP = mean(diaBP),
                                  BMI = mean(BMI),
                                  heartRate = mean(heartRate),
                                  glucose = mean(glucose),
                                  prevalentStroke = "0"))

# REMEMBER convert male_test from numeric to FACTOR
male_test$male <- as.factor(male_test$male) 

male_test$male <- predict(mylogit, newdata = male_test, type = "response")
```


##### Predicted Probability Of Acquiring CVD for Males vs Females

1. Female: `r male_test$male[[1]]` 
2. Males: `r male_test$male[[2]]` 

Odds = `r male_test$male[[2]]/male_test$male[[1]]`



----


<br>
<br>

#### G. Odds of CVD Given Prevalence of Hypertension


```{r include=FALSE}
hyperT_test <- with(df, data.frame(male = "0",
                                   age = mean(age),
                                   education = "0",
                                   cigsPerDay = 0,
                                   prevalentHyp = c("0","1"), # Factor of Interest
                                   diabetes = "0",
                                   totChol = mean(totChol),
                                   sysBP = mean(sysBP),
                                   diaBP = mean(diaBP),
                                   BMI = mean(BMI),
                                   heartRate = mean(heartRate),
                                   glucose = mean(glucose),
                                   prevalentStroke = "0"))

# REMEMBER convert male_test from numeric to FACTOR
hyperT_test$prevalentHyp <- as.factor(hyperT_test$prevalentHyp) 

hyperT_test$prevalentHyp <- predict(mylogit, newdata = hyperT_test, type = "response")
```


##### Predicted Probability Of Acquiring CVD Given Prevalence of Hypertension

1. WITH Prevalence of Hypertension, NO: `r hyperT_test$prevalentHyp[[1]]` 
2. WITH Prevalence of Hypertension, YES: `r hyperT_test$prevalentHyp[[2]]` 

Odds = `r hyperT_test$prevalentHyp[[2]]/hyperT_test$prevalentHyp[[1]]`




<br>
<br>

#### I. Odds of CVD Given Age


```{r include=FALSE}
age_test <- with(df, data.frame(male = "0",
                                   age = c(20,30,40,50,60,70,80),
                                   education = "0",
                                   cigsPerDay = 0,
                                   prevalentHyp = "0",
                                   diabetes = "0",
                                   totChol = mean(totChol),
                                   sysBP = mean(sysBP),
                                   diaBP = mean(diaBP),
                                   BMI = mean(BMI),
                                   heartRate = mean(heartRate),
                                   glucose = mean(glucose),
                                   prevalentStroke = "0"))

age_test$age <- predict(mylogit, newdata = age_test, type = "response")
```


##### Predicted Probability Of Acquiring CVD Given Differing Ages

| No. | Age (years) | Probability Given Age |       Odds Compared to 20 yr old        |
| --: | ----------: | :-------------------: | :-------------------------------------: |
|   1 |          20 | `r age_test$age[[1]]` | `r age_test$age[[1]]/age_test$age[[1]]` |
|   2 |          30 | `r age_test$age[[2]]` | `r age_test$age[[2]]/age_test$age[[1]]` |
|   3 |          40 | `r age_test$age[[3]]` | `r age_test$age[[3]]/age_test$age[[1]]` |
|   4 |          50 | `r age_test$age[[4]]` | `r age_test$age[[4]]/age_test$age[[1]]` |
|   5 |          60 | `r age_test$age[[5]]` | `r age_test$age[[5]]/age_test$age[[1]]` |
|   6 |          70 | `r age_test$age[[6]]` | `r age_test$age[[6]]/age_test$age[[1]]` |
|   7 |          80 | `r age_test$age[[7]]` | `r age_test$age[[7]]/age_test$age[[1]]` |



<br>
<br>

## IV. Conclusion














---


Notes
- USE https://stats.idre.ucla.edu/r/dae/logit-regression/
for analysis

- USE https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faq-how-do-i-interpret-odds-ratios-in-logistic-regression/
for interpretation
