---
title: "The Framingham Heart Study"
subtitle: "Risk Factors For Cardiac Heart Disease"
author: "Report by Matthew Curcio"
date: "12-02-21"
output: html_document
---

Notes
- USE https://stats.idre.ucla.edu/r/dae/logit-regression/
for analysis

- USE https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faq-how-do-i-interpret-odds-ratios-in-logistic-regression/
for interpretation

---

## Executive Summary


1. This report investigates the risk factors that lead to cardiovascular heart disease (CHD) with data from the Framingham Heart Study.[^1]

1. R and a little SQL-Lite were used in this RMarkdown document.

1. The analysis uses logistic regression to determine the five most important factors and the odds.

1. This notebook shows my understanding of statistics, Logistic regression in particular.

* By being a men vs women, the odds of acquiring CHD is an increase x. 

[^1]:The Framingham Heart Study can be found at: https://www.kaggle.com/captainozlem/framingham-chd-preprocessed-data

[^2]:https://github.com/ekstroem/dataReporter

--- 

## Disscussion


The Framingham Heart Study[^1] investigates 14 independent variables using 4,133 participants over a ten year period. 

>Logistic regression is used to understand the relationship between the dependent variable and one or more independent variables by estimating probabilities using a logistic regression equation. This type of analysis can help you predict the likelihood of an event happening or a choice being made.[^2]

[^2]:https://www.ibm.com/topics/logistic-regression

#### Logistic regression is a good choice for this investigation for several reasons.

1. The outcome being investigated, the absence(0) or presence(1) of CHD, is a binary response.
2. We are also interested in knowing the probability of acquiring CHD, since biological systems are infrequently simply off or on. 
3. Knowing more about the probable causes, predictor variables may be important and help mitigate the effects for future prevention.

</br>
The dependent variable is the incidence of acquiring cardiac hear disease (CHD) after ten years from testing.  The variable name in this study is abbreviated `TenYearCHD`.

The model is fit with 13 independent variables.

--- 

Dependent variable: The absence or presence of Cardiac Heart Disease After Ten Years

| No. | Independent Factors (Yes = 1) | No. | Independent Continuous Variables |
| :-- | :---------------------------- | :-- | :------------------------------- |
| 1   | Male-1                        | 1   | Age                              |
| 2   | Education-1                   | 2   | Cigarettes Per Day               |
| 3   | Diabetic-1                    | 3   | Total Cholesterol                |
| 4   | Prevalence of Stroke-1        | 4   | Systolic BP                      |
| 5   | Prevalence of Hypertension-1  | 5   | Diastolic BP                     |
|     |                               | 6   | BMI                              |
|     |                               | 7   | Heart Rate                       |
|     |                               | 8   | Glucose                          |


```{r DONOTSHOW, message=FALSE, warning=FALSE, include=FALSE}
# DO NOT SHOW
options(tinytex.verbose = TRUE)

#Load Libraries
Libraries <- c("knitr", "readr", "tidyverse", "aod", "ggplot2")
for (p in Libraries) { 
    library(p, character.only = TRUE)
}
opts_chunk$set(cache=TRUE, warning=FALSE, message=FALSE)

#Load Data
df <- read_csv("CHD_preprocessed.csv", 
     col_types = cols(male = col_factor(levels = c("0", "1")), 
                      education = col_factor(levels = c("0", "1")),
                      currentSmoker = col_skip(), 
                      BPMeds = col_skip(), 
                      prevalentStroke = col_factor(levels = c("0", "1")), 
                      prevalentHyp = col_factor(levels = c("0", "1")), 
                      diabetes = col_factor(levels = c("0", "1")), 
                      TenYearCHD = col_factor(levels = c("0", "1"))))
#view(df)
```


### 1. Logistic Regression Model


```{r cache=TRUE}
mylogit <- glm(TenYearCHD ~ male + age + education + 
                            cigsPerDay + prevalentStroke + prevalentHyp + 
                            diabetes + totChol + sysBP + diaBP + BMI +
                            heartRate + glucose,
               data = df, 
               family = "binomial")

summary(mylogit)
```


### 2. Wald Test 

- Do The Predictor Variables Describe Our Model


The Wald test is a test of significance for individual regression coefficients in a logistic regression. 

Considering the 13 predictors, neglecting the intercept, we see $\chi^2$ = 333.7 with 13 degrees of freedom. This gives *P << 0.001*.

From this we can conclude that the parameters are significant and do represent useful in describing CHD.


```{r}
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), Terms = 2:14)
```


### 3. Five Most Important Predictors


```{r}
exp(coef(mylogit))
```


##### The 5 most important variables determining the risk of acquiring CHD are:

| No. | Risk Factor                | Odds |
| :-- | :------------------------- | :--- |
| 1   | Prevalence of Stroke       | 2.74 |
| 2   | Is Male                    | 1.62 |
| 3   | prevalence of Hypertension | 1.30 |
| 4   | Is Diabetic                | 1.27 |
| 5   | Age                        | 1.06 |



### 4. Determination of Odds 

- Given All Other Values Held Constant


We will start by calculating the predicted probability of CHCD at with respect to different variables, holding each one constant at their means. First we create and view the data frame.
    
#### A. Prevalence of Stroke Predicted Probability

```{r STROKE}
strok_test <- with(df, data.frame(male = "0",
                                age = mean(age),
                                education = "0",
                                cigsPerDay = 0,
                                prevalentHyp = "0",
                                diabetes = "0",
                                totChol = mean(totChol),
                                sysBP = mean(sysBP),
                                diaBP = mean(diaBP),
                                BMI = mean(BMI),
                                heartRate = mean(heartRate),
                                glucose = mean(glucose),
                                prevalentStroke = c("0","1")))
# view(strok_test)

# REMEMBER convert prevalentStroke from numeric to FACTOR
strok_test$prevalentStroke <- as.factor(strok_test$prevalentStroke) 
# str(strok_test)

strok_test$prevalentStroke <- predict(mylogit, newdata = strok_test, type = "response")
#strok_test$prevalentStroke
```


#####  Odds Of Acquiring CHD Given Prevalence of Stroke

1. WITH Prevalence of Stroke, NO: `r strok_test$prevalentStroke[[1]]` 
2. WITH Prevalence of Stroke, YES: `r strok_test$prevalentStroke[[2]]` 

##### Therefore the odds are: `r strok_test$prevalentStroke[[2]]/strok_test$prevalentStroke[[1]]`


----

#### B. Odds of CHD Given Male Vs Female

```{r include=FALSE}
male_test <- with(df, data.frame(male = c("0","1"),
                                  age = mean(age),
                                  education = "0",
                                  cigsPerDay = 0,
                                  prevalentHyp = "0",
                                  diabetes = "0",
                                  totChol = mean(totChol),
                                  sysBP = mean(sysBP),
                                  diaBP = mean(diaBP),
                                  BMI = mean(BMI),
                                  heartRate = mean(heartRate),
                                  glucose = mean(glucose),
                                  prevalentStroke = "0"))

# REMEMBER convert male_test from numeric to FACTOR
male_test$male <- as.factor(male_test$male) 

male_test$male <- predict(mylogit, newdata = male_test, type = "response")
```


##### Predicted Probability Of Acquiring CHD for Males vs Females

1. Female: `r male_test$male[[1]]` 
2. Males: `r male_test$male[[2]]` 

##### Therefore the odds are: `r male_test$male[[2]]/male_test$male[[1]]`


----


#### C. Odds of CHD Given Prevalence of Hypertension


```{r include=FALSE}
hyperT_test <- with(df, data.frame(male = "0",
                                   age = mean(age),
                                   education = "0",
                                   cigsPerDay = 0,
                                   prevalentHyp = c("0","1"),
                                   diabetes = "0",
                                   totChol = mean(totChol),
                                   sysBP = mean(sysBP),
                                   diaBP = mean(diaBP),
                                   BMI = mean(BMI),
                                   heartRate = mean(heartRate),
                                   glucose = mean(glucose),
                                   prevalentStroke = "0"))

# REMEMBER convert male_test from numeric to FACTOR
hyperT_test$prevalentHyp <- as.factor(hyperT_test$prevalentHyp) 

hyperT_test$prevalentHyp <- predict(mylogit, newdata = hyperT_test, type = "response")
```


##### Predicted Probability Of Acquiring CHD Given Prevalence of Hypertension

1. WITH Prevalence of Hypertension, NO: `r hyperT_test$prevalentHyp[[1]]` 
2. WITH Prevalence of Hypertension, YES: `r hyperT_test$prevalentHyp[[2]]` 

##### Therefore the odds are: `r hyperT_test$prevalentHyp[[2]]/hyperT_test$prevalentHyp[[1]]`



----


#### D. Odds of CHD Given Prevalence of Diabetes


```{r include=FALSE}
Diabetes_test <- with(df, data.frame(male = "0",
                                     age = mean(age),
                                     education = "0",
                                     cigsPerDay = 0,
                                     prevalentHyp = 0,
                                     diabetes = c("0","1"),
                                     totChol = mean(totChol),
                                     sysBP = mean(sysBP),
                                     diaBP = mean(diaBP),
                                     BMI = mean(BMI),
                                     heartRate = mean(heartRate),
                                     glucose = mean(glucose),
                                     prevalentStroke = "0"))

Diabetes_test$diabetes <- as.factor(Diabetes_test$diabetes) 
#Diabetes_test$prevalentHyp <- as.factor(Diabetes_test$prevalentHyp)

Diabetes_test$diabetes <- predict(mylogit, newdata = hyperT_test, type = "response")
```


##### Predicted Probability Of Acquiring CHD Given Prevalence of Diabetes

1. NO Diabetes: `r Diabetes_test$diabetes[[1]]` 
2. WITH Diabetes: `r Diabetes_test$diabetes[[2]]` 

##### Therefore the odds are: `r Diabetes_test$diabetes[[2]]/Diabetes_test$diabetes[[1]]`



----


#### E. Odds of CHD Given Age


```{r include=FALSE}
age_test <- with(df, data.frame(male = "0",
                                   age = mean(age),
                                   education = "0",
                                   cigsPerDay = 0,
                                   prevalentHyp = "0",
                                   diabetes = c("0","1"),
                                   totChol = mean(totChol),
                                   sysBP = mean(sysBP),
                                   diaBP = mean(diaBP),
                                   BMI = mean(BMI),
                                   heartRate = mean(heartRate),
                                   glucose = mean(glucose),
                                   prevalentStroke = "0"))
#view(age_test)

# REMEMBER convert male_test from numeric to FACTOR
age_test$age <- as.factor(age_test$age) 
#str(age_test)

age_test$age <- predict(mylogit, newdata = age_test, type = "response")
#age_test$age
```


##### Predicted Probability Of Acquiring CHD Given Prevalence of Diabetes

1. NO Diabetes: `r Diabetes_test$diabetes[[1]]` 
2. WITH Diabetes: `r Diabetes_test$diabetes[[2]]` 

##### Therefore the odds are: `r Diabetes_test$diabetes[[2]]/Diabetes_test$diabetes[[1]]`


