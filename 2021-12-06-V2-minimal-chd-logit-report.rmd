---
title: "The Framingham Heart Study"
subtitle: "Risk Factors For Cardiac Heart Disease"
author: "Report by Matthew Curcio"
date: "12-02-21"
output: html_document
---


## I. Executive Summary


1. This report investigates the risk factors that lead to cardiovascular disease (CVD) utilizing data from the Framingham Heart Study.[^1]

1. R and SQL-Lite are used in this RMarkdown document.

1. The analysis uses logistic regression to determine the five most important factors and the odds.

    * By being a men vs women, the odds of acquiring CVD is an increase x. 

1. This notebook shows my deeper understanding of Logistic regression. This presentation is part of a series of articles describing Logit.


[^1]:The Framingham Heart Study can be found at: https://www.kaggle.com/captainozlem/framingham-chd-preprocessed-data

--- 

## II. Disscussion


The Framingham Heart Study[^1] investigates 14 independent variables using 4,133 participants over a ten year period. 

Logistic regression is a good choice for this investigation for several reasons.

1. The outcome being investigated, the absence(0) or presence(1) of cardiovascular disease, is a binary response.

1. 

1. Biological systems are infrequently simply off or on in nature. Therefore knowing more about the probable causes, predictor variables may be important and help mitigate the effects for future prevention.

1. We are also interested in finding the factors and their related odds of acquiring CVD.

</br>
The dependent variable is the incidence of acquiring cardiac hear disease (CVD) after ten years from testing.  The variable name in this study is abbreviated `TenYearCHD`.

The model is fit with 13 independent variables.

Dependent variable: The absence or presence of Cardiac Heart Disease After Ten Years

| No. | Independent Factors (Yes = 1) | No. | Independent Continuous Variables |
| :-- | :---------------------------- | :-- | :------------------------------- |
| 1   | Male-1                        | 1   | Age                              |
| 2   | Education-1                   | 2   | Cigarettes Per Day               |
| 3   | Diabetic-1                    | 3   | Total Cholesterol                |
| 4   | Prevalence of Stroke-1        | 4   | Systolic BP                      |
| 5   | Prevalence of Hypertension-1  | 5   | Diastolic BP                     |
|     |                               | 6   | BMI                              |
|     |                               | 7   | Heart Rate                       |
|     |                               | 8   | Glucose                          |

--- 


```{r DONOTSHOW, message=FALSE, warning=FALSE, include=FALSE}
# DO NOT SHOW
options(tinytex.verbose = TRUE)
options(digits = 5) 

#Load Libraries
Libraries <- c("knitr", "readr", "tidyverse", "aod", "ggplot2")
for (p in Libraries) { 
    library(p, character.only = TRUE)
}
opts_chunk$set(cache=TRUE, warning=FALSE, message=FALSE)

#Load Data
df <- read_csv("CHD_preprocessed.csv", 
     col_types = cols(male = col_factor(levels = c("0", "1")), 
                      education = col_factor(levels = c("0", "1")),
                      currentSmoker = col_skip(), 
                      BPMeds = col_skip(), 
                      prevalentStroke = col_factor(levels = c("0", "1")), 
                      prevalentHyp = col_factor(levels = c("0", "1")), 
                      diabetes = col_factor(levels = c("0", "1")), 
                      TenYearCHD = col_factor(levels = c("0", "1"))))
#view(df)
```


## III. Experimental Results

### 1. Logistic Regression Model


```{r cache=TRUE}
mylogit <- glm(TenYearCHD ~ male + age + education + 
                            cigsPerDay + prevalentStroke + prevalentHyp + 
                            diabetes + totChol + sysBP + diaBP + BMI +
                            heartRate + glucose,
               data = df, 
               family = "binomial")

summary(mylogit)
```


### 2. Wald Test 

- Do The Predictor Variables Describe Our Model


The Wald test is a test of significance for individual regression coefficients in a logistic regression. 

Considering the 13 predictors, neglecting the intercept, we see $\chi^2$ = 333.7 with 13 degrees of freedom. This gives *P << 0.001*.

From this we can conclude that the parameters are significant and do represent useful in describing CVD.


```{r}
wald.test(b = coef(mylogit), Sigma = vcov(mylogit), Terms = 2:14)
```


### 3. Five Most Important Predictors


```{r}
exp(coef(mylogit))
```


##### The 5 most important variables determining the risk of acquiring CVD are:

| No. | Risk Factor                |
| :-- | :------------------------- |
| 1   | Prevalence of Stroke       |
| 2   | Is Male                    |
| 3   | prevalence of Hypertension |
| 4   | Is Diabetic                |
| 5   | Age                        |


### 4. Determination of Odds 


We will start by calculating the predicted probability of CHCD at with respect to the five most important variables.  

## NEEDS MORE EXPLANATION
holding each one constant at their means. First we create and view the data frame.
    - Given All Other Values Held Constant
    
#### Example calculations shown for Prevalence of Stroke Factor

```{r STROKE}
strok_test <- with(df, data.frame(male = "0",
                                age = mean(age),
                                education = "0",
                                cigsPerDay = 0,
                                prevalentHyp = "0",
                                diabetes = "0",
                                totChol = mean(totChol),
                                sysBP = mean(sysBP),
                                diaBP = mean(diaBP),
                                BMI = mean(BMI),
                                heartRate = mean(heartRate),
                                glucose = mean(glucose),
                                prevalentStroke = c("0","1"))) # Factor of Interest

# REMEMBER convert prevalentStroke from numeric to FACTOR
strok_test$prevalentStroke <- as.factor(strok_test$prevalentStroke) 
# str(strok_test)

strok_test$prevalentStroke <- predict(mylogit, newdata = strok_test, type = "response")
#strok_test$prevalentStroke
```


#### A. Prevalence of Stroke Predicted Probability


#####  Probabilities Of Acquiring CVD Given Prevalence of Stroke

1. NO Prevalence of Stroke: `r strok_test$prevalentStroke[[1]]` 
2. WITH Prevalence of Stroke: `r strok_test$prevalentStroke[[2]]`

$$\large Odds = \frac{Pr(CVD~WITH~Prevalence~of~Stroke)}{Pr(CVD~NO~Prevalence~of~Stroke)} ~=~ \frac{`r strok_test$prevalentStroke[[2]]`}{`r strok_test$prevalentStroke[[1]]`} ~=~ `r strok_test$prevalentStroke[[2]]/strok_test$prevalentStroke[[1]]`$$

* Therefore the odds are: `r strok_test$prevalentStroke[[2]]/strok_test$prevalentStroke[[1]]`

----

#### B. Odds of CVD Given Male Vs Female

```{r include=FALSE}
male_test <- with(df, data.frame(male = c("0","1"), # Factor of Interest
                                  age = mean(age),
                                  education = "0",
                                  cigsPerDay = 0,
                                  prevalentHyp = "0",
                                  diabetes = "0",
                                  totChol = mean(totChol),
                                  sysBP = mean(sysBP),
                                  diaBP = mean(diaBP),
                                  BMI = mean(BMI),
                                  heartRate = mean(heartRate),
                                  glucose = mean(glucose),
                                  prevalentStroke = "0"))

# REMEMBER convert male_test from numeric to FACTOR
male_test$male <- as.factor(male_test$male) 

male_test$male <- predict(mylogit, newdata = male_test, type = "response")
```


##### Predicted Probability Of Acquiring CVD for Males vs Females

1. Female: `r male_test$male[[1]]` 
2. Males: `r male_test$male[[2]]` 

$$\large Odds = \frac{Pr(Aquiring~CVD~as~a~Male)}{Pr(Aquiring~CVD~as~a~Female)}  ~=~ \frac{`r male_test$male[[2]]`}{`r male_test$male[[1]]`}  ~=~ `r male_test$male[[2]]/male_test$male[[1]]`$$


* Therefore the odds are: `r male_test$male[[2]]/male_test$male[[1]]`


----


#### C. Odds of CVD Given Prevalence of Hypertension


```{r include=FALSE}
hyperT_test <- with(df, data.frame(male = "0",
                                   age = mean(age),
                                   education = "0",
                                   cigsPerDay = 0,
                                   prevalentHyp = c("0","1"), # Factor of Interest
                                   diabetes = "0",
                                   totChol = mean(totChol),
                                   sysBP = mean(sysBP),
                                   diaBP = mean(diaBP),
                                   BMI = mean(BMI),
                                   heartRate = mean(heartRate),
                                   glucose = mean(glucose),
                                   prevalentStroke = "0"))

# REMEMBER convert male_test from numeric to FACTOR
hyperT_test$prevalentHyp <- as.factor(hyperT_test$prevalentHyp) 

hyperT_test$prevalentHyp <- predict(mylogit, newdata = hyperT_test, type = "response")
```


##### Predicted Probability Of Acquiring CVD Given Prevalence of Hypertension

1. WITH Prevalence of Hypertension, NO: `r hyperT_test$prevalentHyp[[1]]` 
2. WITH Prevalence of Hypertension, YES: `r hyperT_test$prevalentHyp[[2]]` 

##### Therefore the odds are: `r hyperT_test$prevalentHyp[[2]]/hyperT_test$prevalentHyp[[1]]`



----


#### D. Prevalence of Diabetes, Odds of CVD ???


```{r include=FALSE}
Diabetes_test <- with(df, data.frame(male = "0",
                                     age = mean(age),
                                     education = "0",
                                     cigsPerDay = 0,
                                     prevalentHyp = "0",
                                     diabetes = c("0","1"), # Factor of Interest
                                     totChol = mean(totChol),
                                     sysBP = mean(sysBP),
                                     diaBP = mean(diaBP),
                                     BMI = mean(BMI),
                                     heartRate = mean(heartRate),
                                     glucose = mean(glucose),
                                     prevalentStroke = "0"))

Diabetes_test$diabetes <- as.factor(Diabetes_test$diabetes) 
#str(Diabetes_test)

Diabetes_test$diabetes <- predict(mylogit, newdata = Diabetes_test, type = "response")
#Diabetes_test$diabetes
```


##### Predicted Probability Of Acquiring CVD Given Prevalence of Diabetes

1. NO Diabetes: `r Diabetes_test$diabetes[[1]]` 
2. WITH Diabetes: `r Diabetes_test$diabetes[[2]]` 

##### Therefore the odds are: `r Diabetes_test$diabetes[[2]]/Diabetes_test$diabetes[[1]]`


----


#### E. Odds of CVD Given Age


```{r include=FALSE}
age_test <- with(df, data.frame(male = "0",
                                   age = c(20,30,40,50,60,70,80),
                                   education = "0",
                                   cigsPerDay = 0,
                                   prevalentHyp = "0",
                                   diabetes = "0",
                                   totChol = mean(totChol),
                                   sysBP = mean(sysBP),
                                   diaBP = mean(diaBP),
                                   BMI = mean(BMI),
                                   heartRate = mean(heartRate),
                                   glucose = mean(glucose),
                                   prevalentStroke = "0"))
#view(age_test)

age_test$age <- predict(mylogit, newdata = age_test, type = "response")
#age_test$age[[1]]
```


##### Predicted Probability Of Acquiring CVD Given Differing Ages

| No. | Age (years) | Probability Given Age |       Odds Compared to 20 yr old        |
| --: | ----------: | :-------------------: | :-------------------------------------: |
|   1 |          20 | `r age_test$age[[1]]` | `r age_test$age[[1]]/age_test$age[[1]]` |
|   2 |          30 | `r age_test$age[[2]]` | `r age_test$age[[2]]/age_test$age[[1]]` |
|   3 |          40 | `r age_test$age[[3]]` | `r age_test$age[[3]]/age_test$age[[1]]` |
|   4 |          50 | `r age_test$age[[4]]` | `r age_test$age[[4]]/age_test$age[[1]]` |
|   5 |          60 | `r age_test$age[[5]]` | `r age_test$age[[5]]/age_test$age[[1]]` |
|   6 |          70 | `r age_test$age[[6]]` | `r age_test$age[[6]]/age_test$age[[1]]` |
|   7 |          80 | `r age_test$age[[7]]` | `r age_test$age[[7]]/age_test$age[[1]]` |

##### Therefore the odds are: `r Diabetes_test$diabetes[[2]]/Diabetes_test$diabetes[[1]]`


## IV. Conclusion



---


Notes
- USE https://stats.idre.ucla.edu/r/dae/logit-regression/
for analysis

- USE https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faq-how-do-i-interpret-odds-ratios-in-logistic-regression/
for interpretation
